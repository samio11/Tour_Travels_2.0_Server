# Tour Travels 2.0 Server  

A **full‑stack Node.js/TypeScript** back‑end for a tour‑booking platform. It provides a **RESTful API** that handles users, tours, bookings, payments, OTP verification, and image uploads, all with solid error handling, authentication, and role‑based access control.

---

## ✨ What the repo offers  

| Feature | Description |
|---------|-------------|
| **Modular Architecture** | Separate `modules` for **auth, user, tour, division, booking, payment, OTP,** and **SSL‑Commerz** integration. |
| **TypeScript** | Strongly‑typed codebase, interfaces and enums for models and services. |
| **Authentication & Authorization** | JWT‑based auth with Passport strategy and role‑based `checkAuth` middleware (SUPER_ADMIN, ADMIN, USER, GUIDE). |
| **File Uploads** | `multer‑storage‑cloudinary` integration for uploading and deleting images on Cloudinary. |
| **Payment Flow** | `Payment` model + `sslCommerz` service for initializing, success, failure & cancellation callbacks. |
| **OTP Service** | Send/verify OTP emails (useful for registration & password reset). |
| **Error Handling** | Centralized error handling (AppError, Cast, Duplicate, Validation, Zod) with `globalErrorHandler`. |
| **Utilities** | `catchAsync`, `sendResponse`, cookie helpers, JWT utilities, query‑builder helpers, and a Redis client wrapper. |
| **Testing** | Ready to be used with Postman collection (`Tour Travels 2.0.postman_collection.json`). |
| **Deployable** | `vercel.json` ready for Vercel serverless deployment (`src/server.ts`). |

---

## 🗂️ Repository structure (high‑level)

```
root
├─ .gitignore
├─ README.md (you’re reading this)
├─ package.json / package‑lock.json
├─ tsconfig.json
├─ vercel.json                # Vercel deployment config
├─ src/
│   ├─ app.ts                 # Express app setup
│   ├─ server.ts              # Entry point
│   └─ app/
│       ├─ config/            # cloudinary, multer, redis, passport
│       ├─ errors/           # custom error classes & handlers
│       ├─ middlewares/   # auth, validation, global error, 404
│       ├─ modules/
│       │   ├─ auth/          # auth controller/routes/service
│       │   ├─ booking/
│       │   ├─ division/
│       │   ├─ otp/
│       │   ├─ payment/
│       │   ├─ sslCommerz/
│       │   ├─ tour/
│       │   └─ user/
│       ├─ routes/          # root router that mounts all module routes
│       └─ utils/          # helper utilities
├─ dist/                     # compiled JavaScript (generated by `npm run build`)
└─ src/app/interfaces/...  # TypeScript type definitions
```

---

## 📦 Core technologies  

| Category | Technology |
|----------|-----------|
| **Runtime** | Node.js (v18+) |
| **Language** | TypeScript |
| **Web framework** | Express |
| **Database** | MongoDB (Mongoose ODM) |
| **Authentication** | JWT + Passport |
| **File storage** | Cloudinary (via `multer-storage-cloudinary`) |
| **Cache / Session** | Redis |
| **Email** | (custom implementation, likely nodemailer) |
| **Payments** | SSL‑Commerz integration (custom service) |
| **Validation** | Zod + Mongoose validation |
| **Testing** | Postman collection |
| **Deployment** | Vercel serverless functions |
| **Package manager** | npm (or Yarn) |

---

## 🚀 Quick start (development)

```bash
# Install dependencies
npm install

# Create a .env file (see .env.example) with:
#   - MONGODB_URI
#   - JWT_SECRET, JWT_REFRESH_SECRET
#   - CLOUDNARY_* (cloudinary credentials)
#   - RADIS_* (Redis credentials)
#   - FRONTEND_URL (CORS origin)
#   - etc.

# Build the TypeScript source
npm run build   # creates /dist

# Run locally
npm start       # runs compiled server (node dist/server.js)
# Or for hot‑reloading during dev:
npm run dev    # ts-node-dev src/server.ts
```

> **Note:** The repository already contains compiled JS in `/dist`. You can run `node dist/server.js` directly after installing dependencies, without building, if you prefer.

---

## 📦 Scripts

| Command | Purpose |
|--------|--------|
| `npm run dev` | Run the server in dev mode (ts-node‑dev). |
| `npm run build` | Compile TypeScript → `/dist`. |
| `npm start` | Run compiled server (`node dist/server.js`). |
| `npm test` | (Not defined) – add your own test suite. |
| `npm lint` | (If lint configured). |

---

## 📚 API Overview  

All routes are prefixed with **`/api/v1`**.

| Module | Base path | Main endpoints |
|------|----------|---------------|
| **Auth** | `/auth` | `login`, `logout`, `refresh-token` (implementation in `auth.controller.ts`) |
| **User** | `/user` | `POST /create`, `GET /get-me`, `GET /all-user` |
| **Tour** | `/tour` | `POST /create-tour-type`, `POST /create-tour`, `GET /get-all-tour-type`, `GET /get-all-tour`, `GET /get-a-tour/:slug` |
| **Division** | `/division` | `POST /create`, `GET /get-division`, `GET /get-a-division/:slug` |
| **Booking** | `/booking` | `POST /create`, `GET /get-all-booking`, `GET /get-a-booking`, `DELETE /delete-booking/:bookingId` |
| **Payment** | `/payment` | `POST /init-payment/:bookingId`, `POST /success`, `/fail`, `/cancel` |
| **OTP** | `/otp` | `POST /send-otp`, `POST /verify-otp` |
| **SSL‑Commerz** | (internal service) | Used by payment service for gateway integration |

All protected routes use the `checkAuth(...roles)` middleware which verifies the JWT stored in cookies and checks the user role.

---

## 📄 Postman collection  

The repository includes `Tour Travels 2.0.postman_collection.json`. Import it into Postman to test all endpoints (including required auth tokens).

---

## 🌐 Deploy to Vercel  

The `vercel.json` file points to `src/server.ts`. After pushing to a Git repo connected to Vercel, the app will be automatically built (`npm run build`) and deployed as a serverless function.

---

## 🛠️ Extending the project  

- **Add new modules**: create a folder under `src/app/modules`, export a router in `src/app/routes/index.ts`.  
- **Add new middleware**: place it under `src/app/middlewares` and register in `globalErrorHandler`.  
- **Add new utilities**: keep them under `src/app/utils`.  

---

## 🎉 Conclusion  

The **Tour Travels 2.0 Server** provides a clean, well‑typed, and modular backend for a travel‑booking platform. It’s ready‑to‑run, easily extensible, and includes everything you need to start building a production‑grade service for tours, bookings, payments, and more. Feel free to fork, adapt, and deploy!
